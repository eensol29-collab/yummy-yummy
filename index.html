<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WHO MADE THIS? YUMMY YUMMY</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    :root { --bg:#f8fafc; --fg:#0f172a; --card:#fff; --muted:#64748b; --border:#e2e8f0; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Pretendard", sans-serif; background:var(--bg); color:var(--fg); }
    .container { max-width: 1000px; margin: 0 auto; padding: 24px; }
    h1 { font-size: 28px; margin: 0 0 8px; text-align:center; }
    p.lead { color: var(--muted); margin: 0 0 24px; text-align:center; }
    .grid { display: grid; gap: 16px; }
    @media (min-width: 800px) { .grid.two { grid-template-columns: 1fr 1fr; } }
    .card { background:var(--card); border: 1px solid var(--border); border-radius: 16px; padding:16px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
    .section-title { font-size: 18px; font-weight: 700; margin-bottom: 12px; text-align:center; }
    .item { display:flex; align-items:center; justify-content:space-between; border:1px solid var(--border); padding:12px; border-radius: 12px; }
    .desc { font-weight:600; white-space:pre-line; }
    .food { font-size:15px; margin-top:4px; color:#334155; }
    .qty { display:flex; align-items:center; }
    .qty input { width: 56px; text-align:center; border-top:1px solid var(--border); border-bottom:1px solid var(--border); padding:6px 0; }
    .btn { padding: 8px 14px; border-radius: 12px; border:1px solid var(--border); background:#fff; cursor:pointer; }
    .btn.primary { background:#0f172a; color:#fff; border-color:#0f172a; }
    .btn:disabled { opacity: .5; cursor: not-allowed; }
    .row { display:flex; gap:12px; align-items:center; }
    .row > * { flex:1; }
    label span { display:block; font-size:12px; color:var(--muted); margin-bottom:6px; }
    input[type="text"], input[type="number"], select { width:100%; padding:10px 12px; border:1px solid var(--border); border-radius: 12px; background:#fff; }
    .total { display:flex; align-items:center; justify-content:space-between; font-weight:700; font-size:18px; }
    .qrwrap { display:flex; flex-direction:column; align-items:center; gap:8px; }
    .qrtext { font-size: 12px; color: var(--muted); word-break: break-all; text-align:center; }
    .note { font-size: 11px; color: var(--muted); }
  </style>
</head>
<body>
  <div class="container">
    <h1>WHO MADE THIS? YUMMY YUMMY</h1>
    <p class="lead">메뉴를 선택하고 수량을 입력하면 총액과 결제용 QR이 생성됩니다. (Venmo / Zelle)</p>

    <div class="grid two">
      <section class="card">
        <div class="section-title">🍰 디저트</div>
        <div id="list-bread" class="grid"></div>
      </section>

      <section class="card">
        <div class="section-title">🍵 음료</div>
        <div id="list-drink" class="grid"></div>
      </section>
    </div>

    <section class="card" style="margin-top:16px;">
      <div class="total">
        <span>총액</span><span id="total">$0.00</span>
      </div>

      <div class="grid two" style="margin-top:12px;">
        <label>
          <span>결제 수단</span>
          <select id="method">
            <option value="Venmo">Venmo</option>
            <option value="Zelle">Zelle</option>
          </select>
        </label>

        <label id="venmo-field">
          <span>Venmo 아이디 (@ 제외)</span>
          <input type="text" id="venmo" value="hjolee1" placeholder="hjolee1"/>
        </label>

        <label id="zelle-field" style="display:none;">
          <span>Zelle 전화번호/이메일</span>
          <input type="text" id="zelle" value="2242891619" placeholder="2242891619"/>
        </label>

        <label>
          <span>메모</span>
          <input type="text" id="note" value="Fundraiser" placeholder="Fundraiser"/>
        </label>
      </div>

      <div class="row" style="margin-top:12px;">
        <button id="makeqr" class="btn primary">QR 생성</button>
        <a id="venmolink" class="btn" href="#" target="_blank" rel="noreferrer" style="display:none;">Venmo 링크 열기</a>
      </div>

      <div class="qrwrap" style="margin-top:12px; display:none;" id="qrwrap">
        <div id="qrcode"></div>
        <div class="qrtext" id="qrtext"></div>
        <p class="note" id="zellnote" style="display:none;">Zelle은 공식 웹 결제 링크가 없어 송금 정보가 QR에 텍스트로 들어갑니다. 스캔 후 앱에서 수취인/금액/메모를 확인해 전송하세요.</p>
      </div>
    </section>
  </div>

  <script>
    const ITEMS = [
      { desc: "여기가 바로 포르투갈!", name: "에그타르트 (1개)", price: 5, category: "bread" },
      { desc: "여기가 바로 포르투갈!", name: "에그타르트 (2개)", price: 9, category: "bread" },
      { desc: "지금까지 이런 쫀득은 없었다", name: "쫀득쿠키", price: 6, category: "bread" },
      { desc: "Levain보다 맛있을껄?", name: "스콘", price: 6, category: "bread" },
      { desc: "초보의 손끝에서 나온 명작", name: "티라미수", price: 9, category: "bread" },
      { desc: "단맛은 줄이고 향은 늘렸다", name: "유자에이드", price: 4.5, category: "drink" },
      { desc: "비타민이 아니라 힐링이야", name: "자몽에이드", price: 5.5, category: "drink" },
      { desc: "엄마가 타준 그 맛", name: "미숫가루", price: 5.5, category: "drink" },
      { desc: "", name: "이건 그냥 커피", price: 3, category: "drink" }
    ];

    const listBread = document.getElementById('list-bread');
    const listDrink = document.getElementById('list-drink');
    const totalEl = document.getElementById('total');
    const methodEl = document.getElementById('method');
    const venmoField = document.getElementById('venmo-field');
    const zelleField = document.getElementById('zelle-field');
    const venmoEl = document.getElementById('venmo');
    const zelleEl = document.getElementById('zelle');
    const noteEl = document.getElementById('note');
    const makeqrBtn = document.getElementById('makeqr');
    const venmoLink = document.getElementById('venmolink');
    const qrwrap = document.getElementById('qrwrap');
    const qrcodeBox = document.getElementById('qrcode');
    const qrtext = document.getElementById('qrtext');
    const zellnote = document.getElementById('zellnote');

    function money(n){ return `$${(n||0).toFixed(2)}`; }
    function clamp(n, min=0, max=9999){ return Math.min(max, Math.max(min,n)); }

    function renderList() {
      listBread.innerHTML = "";
      listDrink.innerHTML = "";
      ITEMS.forEach(it => {
        const div = document.createElement('div');
        div.className = 'item';

        const left = document.createElement('div');
        const desc = document.createElement('div');
        desc.className = 'desc';
        desc.textContent = it.desc;
        const name = document.createElement('div');
        name.className = 'food';
        name.textContent = `${it.name} — ${money(it.price)}`;
        left.appendChild(desc);
        left.appendChild(name);

        const right = document.createElement('div');
        right.className = 'qty';
        const minus = document.createElement('button');
        minus.className = 'btn';
        minus.textContent = '−';
        minus.onclick = () => { it.qty = clamp((it.qty||0) - 1, 0); update(); };
        const input = document.createElement('input');
        input.type = 'number';
        input.value = it.qty || 0;
        input.onchange = (e) => { it.qty = clamp(Number(e.target.value)||0,0); update(); };
        const plus = document.createElement('button');
        plus.className = 'btn';
        plus.textContent = '+';
        plus.onclick = () => { it.qty = clamp((it.qty||0) + 1,0); update(); };
        right.appendChild(minus);
        right.appendChild(input);
        right.appendChild(plus);

        div.appendChild(left);
        div.appendChild(right);

        if (it.category === 'bread') listBread.appendChild(div);
        else listDrink.appendChild(div);
      });
    }

    function calcTotal(){
      return ITEMS.reduce((s, it) => s + it.price * (it.qty || 0), 0);
    }

    function venmoUrl(amount, note, handle){
      const h = (handle||'').replace(/^@+/, '').trim();
      if(!h) return null;
      const amt = amount.toFixed(2);
      const memo = encodeURIComponent(note||'Fundraiser');
      return `https://venmo.com/${h}?txn=pay&amount=${amt}&note=${memo}`;
    }

    let qr;
    function makeQR(content){
      qrcodeBox.innerHTML = "";
      qr = new QRCode(qrcodeBox, {
        text: content || "",
        width: 220,
        height: 220,
        correctLevel: QRCode.CorrectLevel.M
      });
    }

    function update(){
      renderList();
      const t = calcTotal();
      totalEl.textContent = money(t);
      venmoLink.style.display = 'none';
      qrwrap.style.display = 'none';
      qrtext.textContent = '';
      zellnote.style.display = 'none';
    }

    methodEl.addEventListener('change', () => {
      if (methodEl.value === 'Venmo') {
        venmoField.style.display = '';
        zelleField.style.display = 'none';
      } else {
        venmoField.style.display = 'none';
        zelleField.style.display = '';
      }
      qrwrap.style.display = 'none';
      venmoLink.style.display = 'none';
    });

    makeqrBtn.addEventListener('click', () => {
      const t = calcTotal();
      const note = noteEl.value || 'Fundraiser';
      const method = methodEl.value;
      let content = "";
      venmoLink.style.display = 'none';
      zellnote.style.display = 'none';

      if (method === 'Venmo') {
        const url = venmoUrl(t, note, venmoEl.value);
        if (!url) { alert('Venmo 아이디를 입력하세요.'); return; }
        content = url;
        venmoLink.href = url;
        venmoLink.style.display = '';
        qrtext.textContent = url;
      } else {
        const to = zelleEl.value.trim();
        if (!to) { alert('Zelle 전화번호/이메일을 입력하세요.'); return; }
        content = `Zelle Payment\nTo: ${to}\nAmount: $${t.toFixed(2)}\nNote: ${note}`;
        qrtext.innerHTML = `Zelle: ${to}<br>Amount: ${money(t)}<br>Note: ${note}`;
        zellnote.style.display = '';
      }

      makeQR(content);
      qrwrap.style.display = '';
    });

    renderList();
    update();
  </script>
</body>
</html>
